---
layout: post
title: 我的工具记录（6）- 用户行为跟踪
description: 记录我使用的一些工具（5）- 用户行为跟踪
categories: [tools]
tags: [development, productive]
redirect_from:
  - /2019/08/25/
---

# 如何跟踪用户使用数据

刚开始做PC Web的预定网页的时候，我的同事经常问我，有什么办法能够看到我们网站的用户使用情况？有多少人使用？我们从搜索到预定付费过程中，每一步转化率如何？也有行话管这个叫埋点。

## Google Analytics

我的第一直观印象是用GA，很早之前就在用GA，不过经过一番调查发现GA在境内会有很大比例数据丢失，而且js文件在境外，所以如果加载起来慢，就会影响整个网页的加载速度。

## GrowingIO

不得不说真是个神器，号称“无感接入”，集成起来也很方便，Dasnhboard做得也很直观，好用。我注册完之后，GrowingIO的同学电话过来，跟我聊了很久，介绍产品等等。不过话说回来，我们每年付费小几万来用，感觉还是有点肉疼，最后不得不忍痛割爱。。。


## 诸葛

放弃GrowingIO之后，我又找了一些国内的类似的产品，发现有诸葛、友盟、百度等等。后来看到有评论说某厂商一开始让免费用，等变成深度依赖的时候，突然打电话，说如果不付费，将会关闭xxx等核心功能。所以为了避免趟到坑里，我最后还是选择退而求其次找自己host的产品了。

## PiWik(matomo)

[Matomo](https://github.com/matomo-org/matomo) 是我最后选定的解决方案，它现在在Github上已经有进12K star了。是个十分火爆的项目，通过自己host也不用担心自己的用户数据同时也被巨头留了一份copy。

它的集成办法跟GA类似，在首页里面加上对javascript库的引用，并且通过后台生成网站Tracking ID之后，写在网页里面。这样就可以基本实现跟踪用户访问了哪些网页。

如果需要跟踪用户的行为，比如点击了什么按钮，Matomo也提供了一个非常简单的入口，只需要调用它的库发送一个类似 "action_name", "parameter", "category"的参数就可以实现。通过对行为的跟踪，比如每个页面上的关键行为的跟踪，在后台就可以很方便的找到转化漏斗中每一步的转化率，然后有针对性优化。

## APP咋办？

现在市面上友盟可能是对App支持比较好的工具，不过为了打造“Single Source of Truth”，我还是决定跟Matomo集成。我的App是基于[Google Flutter](https://flutter.dev)的，好的是，有人写了一个简单集成的库[Flutter Matomo](https://github.com/qinwenshi/flutter_matomo)，我fork之后对iOS的swift version做了一点微调。

集成起来也比较容易，在Main里面初始化TrackingId，然后把所有想要跟踪的网页的基类从```StatelessWidget```改成```TraceableStatelessWidget```，把```StatefulWidget```改成```TraceableStatefulWidget```。这样就可以不需要特殊配置实现APP页面访问的跟踪了。

## 写在后面

用户行为分析是一个很关键的环节，可以告诉我们在哪一步转化出现问题。有个小插曲，我们在各个攻略、车站的介绍等网页到处都插入的一个内嵌的搜索框，只要点击搜素就能直接跳转到搜索结果。数据显示UV大幅增加，我的同事认为在这个内嵌搜索的帮助下增加了很大的用户访问量。而实际上把一个月的数据拉出来，展开转化漏斗的时候，才发现其实转化率从攻略到搜索很低。另一步是从提交用户信息之后，到付费这一步的时候，有大量跳出。这其实也某种程度上说明了，一方面很多人做攻略的时候会参考，但是真正预定可能会找到其他的渠道。另一方面，我们增加的手续费让很多人放弃预定了。在数据的帮助下，找到一些问题，我们开始商量下一步了。。。。

